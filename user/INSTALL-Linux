Installing tcpcrypt on Linux
============================

Tcpcrypt has 2 separate implementations: kernel and userland. These
instructions cover only the userland tcpcrypt, which is easier to set up.


Dependencies
============

 * OpenSSL >= 0.9.8
 * libnfnetlink >= 0.0.40
 * libnetfilter_queue >= 0.0.16
 * libcap

Ubuntu packages
---------------
apt-get install iptables libcap-dev libssl-dev \
                libnfnetlink-dev libnetfilter-queue-dev

{TODO: add packages for other distros}

Compiling
=========

In the tcpcrypt/user directory, run:

   ./configure
   make


Running
=======

Try it out
----------

The included launch_tcpcryptd.sh script will set up firewall rules and start
tcpcryptd so that all of your Web traffic is encrypted with tcpcrypt. When you
run it, you should see something like:

   $ sudo ./launch_tcpcryptd.sh 
   Setting iptables rules...
   Initializing...
   Running

(You may see "No timestamp provided in packet" warnings; don't worry about those.)

Now, check that your Web traffic is being tcpcrypted by opening
http://tcpcrypt.org/fame.php in your Web browser. If everything's working, you
will see a text box where you can post a message to the tcpcrypt Hall of Fame,
and your tcpcrypt session ID is displayed at the bottom of the page. If you're
having problems, see the "Troubleshooting" section below.

Next, let's verify that the packets to and from tcpcrypt.org are not being sent
in cleartext. As root, run `tcpdump -s1500 -A host tcpcrypt.org` and then
browse around the tcpcrypt.org site. Compare this tcpdump output with what you
see after quitting the launch_tcpcryptd.sh script. With tcpcrypt, the traffic
appears encrypted; without tcpcrypt, the traffic is in cleartext.

While tcpcryptd is running, you can still browse non-tcpcrypted sites as
before. Tcpcrypt is backwards compatible; it only encrypts traffic to and from
other tcpcrypt-enabled hosts.

{TODO: move the bits that are common to linux and bsd to README-unix. Make a
page at http://tcpcrypt.org/test.php that either redirects to the hall of fame
(if tcpcrypt is working) or else shows troubleshooting info (if tcpcrypt is not
working).}

Troubleshooting
---------------

If it's not working, the most likely causes are the following.

   * There's a conflict with your existing iptables firewall rules. See the
     "Firewall setup" section below.

   * Your browser already had an open, non-tcpcrypted TCP connection to
     tcpcrypt.org before you ran the launch script. Quit and reopen your
     browser, wait 30 seconds, or use a different browser to retrieve the
     tcpcrypt.org URL.

Visit http://wiki.github.com/sorbo/tcpcrypt/troubleshooting if you're still
unable to make it work.


iptables firewall setup
=======================

...TODO...